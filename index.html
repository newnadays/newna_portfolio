<script type="module">
  function formatDate(timestamp) {
    const date = new Date(timestamp);
    return date.toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  }

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCDPK18JOD0qqKU7mVMUSFwkoDaAbuKvuk",
    authDomain: "newna-project.firebaseapp.com",
    databaseURL: "https://newna-project-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "newna-project",
    storageBucket: "newna-project.firebasestorage.app",
    messagingSenderId: "398829933672",
    appId: "1:398829933672:web:29954a15097390f0b897dd",
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  function submitMessage() {
    const nickname = document.getElementById("nickname").value.trim();
    const message = document.getElementById("message").value.trim();

    if (!nickname || !message) {
      alert("닉네임과 메시지를 모두 입력해주세요!");
      return;
    }

    push(ref(db, "guestbook"), {
      nickname,
      message,
      time: Date.now(),
    });

    document.getElementById("nickname").value = "";
    document.getElementById("message").value = "";
  }

  const messagesDiv = document.getElementById("messages");
  const messageList = [];

  onChildAdded(ref(db, "guestbook"), (data) => {
    const entry = data.val();
    const div = document.createElement("div");
    div.className = "message";

    const dateStr = formatDate(entry.time);
    div.innerHTML = `<strong>${entry.nickname}</strong> <span style="font-size: 0.9em; color: #888;">(${dateStr})</span><br>${entry.message}`;

    messageList.unshift(div);
    if (messageList.length > 5) {
      const removed = messageList.pop();
      messagesDiv.removeChild(removed);
    }

    messagesDiv.prepend(div);
  });

  document.getElementById("submitBtn").addEventListener("click", submitMessage);
</script>
